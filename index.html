<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eruda on all Sites</title>
</head>
<body>
    <!-- <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script> -->
    <form onSubmit="return getAndLoadPage();">
        <input class="input" type="text" id="url" value="https://github.com/" /><button>Load Page</button>
    </form><button onclick="goFullScreen()">Go Full Screen</button>
    <br>
    <iframe id="output" style="width: 100%; height: 90vh; border: none;" allowfullscreen></iframe>

    <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
    <script>
        if (window.location.href.includes("?inDev=true")){
            eruda.init();
        }
    </script>
    <script>
        function goFullScreen(){
            document.getElementById("output").requestFullscreen().then(function() {
                //entered full screen
            }).catch(function(error) {console.log(error.message);})}//error must have happened, log to console
        function getAndLoadPage () {
          var url = document.getElementById('url');

          var xmlhttp = new XMLHttpRequest();

          xmlhttp.onreadystatechange = function () {
              if (this.readyState == 4 && this.status == 200) {
                  var myArr = JSON.parse(this.responseText);
                  updatePreview(myArr);
              }
          };

          xmlhttp.open('GET', document.location.protocol + '//api.allorigins.win/get?url='+escape(url.value, true));
          xmlhttp.send();


          function updatePreview (data) {
            var iframe = document.getElementById('output');
            var doc = iframe.document;

            if(iframe.contentDocument) {
              doc = iframe.contentDocument;
            } else if(iframe.contentWindow) {
              doc = iframe.contentWindow.document;
            }
            doc.open();
            doc.writeln(data.contents);
            doc.close();
            var erudaScript = doc.createElement('script');
            erudaScript.src = 'https://cdn.jsdelivr.net/npm/eruda';
            erudaScript.onload = () => {
                doc.defaultView.eruda.init();
            }
          }
          return false;
        }
    </script>
</body>
</html>
