<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eruda on all Sites</title>
</head>
<body>
    <!-- <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script> -->
    <form onSubmit="return getAndLoadPage();">
        <input class="input" type="text" id="url" value="https://google.com/"/><button>Load Page</button><button onclick="goFullScreen()">Go Full Screen</button>
    </form>
    <br>
    <iframe id="output" style="width: 100%; height: 90vh; border: none;" allowfullscreen></iframe>

    <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
    <script>
        if (window.location.href.includes("?inDev=true")) {
            eruda.init();
        }
    </script>
    <script>
        function goFullScreen() {
            document.getElementById("output").requestFullscreen().then(function() {
                // Entered full screen
            }).catch(function(error) {
                console.log(error.message); // Log error if it occurs
            });
        }

        function getAndLoadPage() {
            var url = document.getElementById('url').value;

            var xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    var response = JSON.parse(this.responseText);
                    var htmlContent = response.contents; // Extract HTML content from JSON
                    updatePreview(htmlContent);
                }
            };

            xmlhttp.open('GET', document.location.protocol + '//api.allorigins.win/get?url=' + encodeURIComponent(url));
            xmlhttp.send();

            function updatePreview(htmlContent) {
                var iframe = document.getElementById('output');
                var doc = iframe.contentDocument || iframe.contentWindow.document;

                doc.open();
                doc.write(htmlContent);
                doc.close();

                // Add event listener to handle link clicks
                doc.addEventListener('click', function(event) {
                    if (event.target.tagName === 'A' && event.target.href) {
                        event.preventDefault(); // Prevent the default link behavior
                        handleLinkClick(event.target.href); // Call parent function
                    }
                });

                var erudaScript = doc.createElement('script');
                erudaScript.src = 'https://cdn.jsdelivr.net/npm/eruda';
                erudaScript.onload = () => {
                    doc.defaultView.eruda.init();
                };
                doc.body.appendChild(erudaScript);
            }

            return false;
        }

        function handleLinkClick(href) {
            // Update the URL input and load the new page
            document.getElementById('url').value = href;
            getAndLoadPage(); // Reload the page using the new URL
        }
    </script>
</body>
</html>
